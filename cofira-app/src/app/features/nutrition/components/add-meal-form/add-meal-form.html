<div class="add-meal-form">
          <button type="button" class="c-button c-button--primary add-meal-form__toggle" (click)="toggleForm()">
                    @if (showForm()) {
                    Cancelar
                    } @else {
                    + Agregar Comida
                    }
          </button>

          @if (showForm()) {
          <form [formGroup]="mealForm" (ngSubmit)="onSubmit()" class="add-meal-form__form c-card">
                    <h3>Nueva Comida</h3>

                    <div class="form-group">
                              <label for="mealType">Tipo de Comida</label>
                              <select id="mealType" formControlName="mealType" class="form-control">
                                        @for (type of mealTypes; track type) {
                                        <option [value]="type">{{ type }}</option>
                                        }
                              </select>
                    </div>

                    <div class="form-group">
                              <label for="date">Fecha</label>
                              <input type="date" id="date" formControlName="date" class="form-control" />
                    </div>

                    <div formArrayName="foods" class="add-meal-form__foods">
                              <h4>Alimentos</h4>
                              @for (food of foods.controls; track $index; let i = $index) {
                              <div [formGroupName]="i" class="food-item c-card">
                                        <div class="food-item__header">
                                                  <h5>Alimento {{ i + 1 }}</h5>
                                                  @if (foods.length > 1) {
                                                  <button type="button" (click)="removeFood(i)"
                                                            class="c-button c-button--secondary"
                                                            aria-label="Eliminar alimento">
                                                            ✕
                                                  </button>
                                                  }
                                        </div>

                                        <div class="form-row">
                                                  <div class="form-group">
                                                            <label [for]="'name-' + i">Nombre</label>
                                                            <input [id]="'name-' + i" type="text" formControlName="name"
                                                                      class="form-control"
                                                                      placeholder="Ej: Pechuga de pollo" />
                                                            @if (food.get('name')?.invalid && food.get('name')?.touched)
                                                            {
                                                            <small class="error-text">El nombre es requerido</small>
                                                            }
                                                  </div>

                                                  <div class="form-group">
                                                            <label [for]="'quantity-' + i">Cantidad</label>
                                                            <input [id]="'quantity-' + i" type="text"
                                                                      formControlName="quantity" class="form-control"
                                                                      placeholder="Ej: 150g" />
                                                  </div>
                                        </div>

                                        <div class="form-row">
                                                  <div class="form-group">
                                                            <label [for]="'calories-' + i">Calorías</label>
                                                            <input [id]="'calories-' + i" type="number"
                                                                      formControlName="calories" class="form-control"
                                                                      min="0" />
                                                  </div>

                                                  <div class="form-group">
                                                            <label [for]="'protein-' + i">Proteína (g)</label>
                                                            <input [id]="'protein-' + i" type="number"
                                                                      formControlName="protein" class="form-control"
                                                                      min="0" />
                                                  </div>

                                                  <div class="form-group">
                                                            <label [for]="'carbs-' + i">Carbohidratos (g)</label>
                                                            <input [id]="'carbs-' + i" type="number"
                                                                      formControlName="carbs" class="form-control"
                                                                      min="0" />
                                                  </div>
                                        </div>

                                        <div class="form-row">
                                                  <div class="form-group">
                                                            <label [for]="'fat-' + i">Grasas (g)</label>
                                                            <input [id]="'fat-' + i" type="number" formControlName="fat"
                                                                      class="form-control" min="0" />
                                                  </div>

                                                  <div class="form-group">
                                                            <label [for]="'fiber-' + i">Fibra (g)</label>
                                                            <input [id]="'fiber-' + i" type="number"
                                                                      formControlName="fiber" class="form-control"
                                                                      min="0" />
                                                  </div>
                                        </div>
                              </div>
                              }

                              <button type="button" (click)="addFood()"
                                        class="c-button c-button--secondary add-meal-form__add-food">
                                        + Agregar Alimento
                              </button>
                    </div>

                    <div class="form-actions">
                              <button type="submit" class="c-button c-button--primary"
                                        [disabled]="!mealForm.valid || isSubmitting()">
                                        @if (isSubmitting()) {
                                        Guardando...
                                        } @else {
                                        Guardar Comida
                                        }
                              </button>
                              <button type="button" (click)="toggleForm()" class="c-button c-button--secondary">
                                        Cancelar
                              </button>
                    </div>
          </form>
          }
</div>